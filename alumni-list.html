<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KQ8N44LDXR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KQ8N44LDXR');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alumni Directory - BSF School Alumni Network</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --bg-card-hover: #2a2a2a;
            --primary: #bb86fc;
            --primary-variant: #3700b3;
            --secondary: #03dac6;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #cf6679;
            --success: #4caf50;
            --warning: #ff9800;
            --male-color: #2196f3;
            --female-color: #e91e63;
            --other-color: #ffc107;
            --instagram-color: #E1306C;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            width: 100%;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            background: #2c3e50;
        }

        .title {
            font-size: 28px;
            color: var(--text-primary);
            font-weight: 700;
        }

        .subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Navigation */
        nav {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--primary);
            background-color: rgba(187, 134, 252, 0.1);
        }

        .nav-link.active {
            color: var(--primary);
            background-color: rgba(187, 134, 252, 0.1);
        }

        /* Directory Header */
        .directory-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .directory-title {
            font-size: 36px;
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .directory-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .profile-count {
            background: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }

        /* Search and Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .search-container {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            background: var(--bg-card);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.2);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Alumni Grid */
        .alumni-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .alumni-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .alumni-card:hover {
            transform: translateY(-5px);
            background: var(--bg-card-hover);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .alumni-card.student {
            border: 2px solid var(--success);
        }

        .alumni-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            font-weight: 600;
            position: relative;
        }

        .alumni-avatar.male {
            background: var(--male-color);
        }

        .alumni-avatar.female {
            background: var(--female-color);
        }

        .alumni-avatar.other {
            background: var(--other-color);
        }

        .alumni-name {
            font-size: 22px;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-weight: 600;
        }

        .alumni-status {
            font-size: 14px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .alumni-year {
            font-size: 14px;
            color: var(--secondary);
            margin-top: 5px;
            font-weight: 500;
        }

        .student-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .instagram-container {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .instagram-link {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--instagram-color);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 20px;
            background: rgba(225, 48, 108, 0.1);
        }

        .instagram-link:hover {
            background: rgba(225, 48, 108, 0.2);
            transform: scale(1.05);
        }

        .instagram-link.disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
            background: rgba(160, 160, 160, 0.1);
        }

        .instagram-link.disabled:hover {
            background: rgba(160, 160, 160, 0.1);
            transform: none;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .pagination-btn {
            padding: 10px 15px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover {
            background: var(--primary);
            color: white;
        }

        .pagination-btn.active {
            background: var(--primary);
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn:disabled:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        /* Loading and Error States */
        .loading, .error, .no-data {
            text-align: center;
            padding: 50px 20px;
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .loading i, .error i, .no-data i {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .loading {
            color: var(--secondary);
        }

        .error {
            color: var(--accent);
        }

        .no-data {
            color: var(--text-secondary);
        }

        /* Back Button */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            gap: 12px;
        }

        /* Footer */
        footer {
            margin-top: 40px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
            padding: 20px;
            width: 100%;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Mobile Styles */
        @media (max-width: 992px) {
            .alumni-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            nav {
                width: 100%;
                justify-content: center;
            }
            
            .title {
                font-size: 24px;
            }
            
            .logo {
                width: 60px;
                height: 60px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-container {
                min-width: 100%;
            }
            
            .directory-title {
                font-size: 28px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .title {
                font-size: 20px;
            }
            
            .alumni-grid {
                grid-template-columns: 1fr;
            }
            
            .alumni-card {
                padding: 20px 15px;
            }
            
            .alumni-avatar {
                width: 80px;
                height: 80px;
                font-size: 32px;
            }
            
            .alumni-name {
                font-size: 18px;
            }
            
            .directory-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>

        <header>
            <div class="logo-container">
                <div class="logo">
                    <img src="logo.png" alt="BSF School Alumni Network Logo" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <div>
                    <h1 class="title">BSF School Alumni Network</h1>
                    <p class="subtitle">Connecting Alumni Across Generations</p>
                </div>
            </div>
            
            <nav>
                <a href="index.html" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="team.html" class="nav-link">Our Team</a>
                <a href="cybersecurity.html" class="nav-link">Cyber Security</a>
                <a href="directory.html" class="nav-link active">Alumni Directory</a>
            </nav>
        </header>

        <div class="directory-header">
            <h1 class="directory-title">Alumni Directory</h1>
            <p class="directory-subtitle">Meet our growing community of BSF School alumni and current students</p>
            <div id="profileCount" class="profile-count">Loading profiles...</div>
        </div>

        <div class="controls">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search by name...">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>

        <div id="loading" class="loading">
            <i class="fas fa-spinner fa-spin"></i>
            <h3>Loading Alumni Directory...</h3>
            <p>Please wait while we fetch the latest data</p>
        </div>

        <div id="error" class="error" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Unable to Load Directory</h3>
            <p id="errorMessage">There was an error loading the alumni data. Please try again later.</p>
            <button id="retryButton" class="pagination-btn" style="margin-top: 15px;">
                <i class="fas fa-redo"></i> Try Again
            </button>
        </div>

        <div id="noData" class="no-data" style="display: none;">
            <i class="fas fa-users"></i>
            <h3>No Alumni Found</h3>
            <p>There are no approved alumni to display at this time.</p>
        </div>

        <div id="alumniGrid" class="alumni-grid" style="display: none;"></div>

        <div id="pagination" class="pagination" style="display: none;"></div>
        
        <footer>
            <p>BSF School Alumni Network &copy; 2023 | Connecting Past, Present and Future</p>
        </footer>
    </div>

    <script>
        // Configuration
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRMkv6MQMmMBNEtpGnfREfe1Dk_MMq06of128N2jAhDIMz2K-WGbWpq--0qfNvE_UQehZ88kTcHAMol/pub?output=csv';
        const ITEMS_PER_PAGE = 9; // 3 columns x 3 rows
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 2000; // 2 seconds

        // DOM Elements
        const alumniGrid = document.getElementById('alumniGrid');
        const pagination = document.getElementById('pagination');
        const searchInput = document.getElementById('searchInput');
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const noDataEl = document.getElementById('noData');
        const errorMessage = document.getElementById('errorMessage');
        const profileCount = document.getElementById('profileCount');
        const retryButton = document.getElementById('retryButton');

        // Global variables
        let allAlumni = [];
        let currentPage = 1;
        let filteredAlumni = [];
        let retryCount = 0;

        // Initialize the directory
        async function initDirectory() {
            try {
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                noDataEl.style.display = 'none';
                alumniGrid.style.display = 'none';
                pagination.style.display = 'none';
                profileCount.textContent = 'Loading profiles...';

                // Fetch data from Google Sheet CSV
                const response = await fetchWithRetry(CSV_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                
                // Parse CSV data
                const data = parseCSV(csvText);
                
                if (data.length === 0) {
                    showNoData();
                } else {
                    allAlumni = data;
                    filteredAlumni = [...allAlumni];
                    
                    // Sort alumni by name
                    filteredAlumni.sort((a, b) => {
                        const nameA = `${a.name} ${a.surname}`.toLowerCase();
                        const nameB = `${b.name} ${b.surname}`.toLowerCase();
                        return nameA.localeCompare(nameB);
                    });

                    updateProfileCount();

                    if (filteredAlumni.length === 0) {
                        showNoData();
                    } else {
                        renderAlumniGrid();
                        renderPagination();
                        loadingEl.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error loading alumni data:', error);
                showError(error.message);
            }
        }

        // Fetch with retry logic
        async function fetchWithRetry(url, retries = MAX_RETRIES) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response;
            } catch (error) {
                if (retries > 0) {
                    console.log(`Retrying fetch... ${retries} attempts left`);
                    await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));
                    return fetchWithRetry(url, retries - 1);
                } else {
                    throw error;
                }
            }
        }

        // Update profile count display
        function updateProfileCount() {
            const totalCount = allAlumni.length;
            const filteredCount = filteredAlumni.length;
            
            if (totalCount === filteredCount) {
                profileCount.textContent = `${totalCount} Alumni Profiles`;
            } else {
                profileCount.textContent = `${filteredCount} of ${totalCount} Alumni Profiles`;
            }
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const alumni = [];
            
            // Skip header row
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                try {
                    // Handle CSV values that might contain commas
                    const columns = parseCSVLine(line);
                    
                    // Extract data from columns
                    // Column B (index 1): Name
                    // Column C (index 2): Surname
                    // Column F (index 5): Instagram_ID
                    // Column J (index 9): PassOut_Year
                    // Column L (index 11): Status
                    if (columns.length >= 12) {
                        const name = columns[1] || '';
                        const surname = columns[2] || '';
                        const instagramId = columns[5] || '';
                        const passoutYear = columns[9] || '';
                        const status = columns[11] || '';
                        
                        // Only include approved alumni
                        if (name && surname && status.toLowerCase() === 'approved') {
                            // Generate consistent gender based on name hash
                            const nameHash = simpleHash(name + surname);
                            const genderIndex = nameHash % 3;
                            const genders = ['Male', 'Female', 'Other'];
                            const gender = genders[genderIndex];
                            
                            // Determine if current student based on passout year
                            const isCurrentStudent = passoutYear.toUpperCase() === 'N/A' || 
                                                   passoutYear.trim() === '' ||
                                                   passoutYear.toLowerCase() === 'current';
                            
                            // Format passout year display
                            let yearDisplay = passoutYear.trim();
                            if (isCurrentStudent) {
                                yearDisplay = 'In School';
                            }
                            
                            // Validate Instagram ID
                            let instagramValid = false;
                            let instagramDisplay = '';
                            
                            if (instagramId && instagramId.trim() !== '') {
                                const cleanId = instagramId.trim().replace('@', '');
                                if (isValidInstagramId(cleanId)) {
                                    instagramValid = true;
                                    instagramDisplay = cleanId;
                                } else {
                                    instagramDisplay = 'Invalid ID';
                                }
                            }
                            
                            alumni.push({
                                name: name.trim(),
                                surname: surname.trim(),
                                gender: gender,
                                passoutYear: yearDisplay,
                                isCurrentStudent: isCurrentStudent,
                                instagramId: instagramDisplay,
                                instagramValid: instagramValid
                            });
                        }
                    }
                } catch (error) {
                    console.warn('Error parsing CSV line:', error, line);
                    // Continue processing other lines
                }
            }
            
            return alumni;
        }

        // Validate Instagram ID format
        function isValidInstagramId(id) {
            // Instagram username rules:
            // - Only letters, numbers, periods, underscores
            // - Between 1 and 30 characters
            // - Cannot start or end with a period
            // - Cannot have consecutive periods
            const instagramRegex = /^(?!.*\.\.)(?!.*\.$)(?!^\.)[a-zA-Z0-9._]{1,30}$/;
            return instagramRegex.test(id);
        }

        // Simple hash function for consistent results
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }

        // Parse a CSV line, handling quoted values with commas
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }

        // Render alumni grid
        function renderAlumniGrid() {
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const alumniToShow = filteredAlumni.slice(startIndex, endIndex);

            alumniGrid.innerHTML = '';

            alumniToShow.forEach(alumni => {
                const card = createAlumniCard(alumni);
                alumniGrid.appendChild(card);
            });

            alumniGrid.style.display = 'grid';
        }

        // Create alumni card
        function createAlumniCard(alumni) {
            const card = document.createElement('div');
            card.className = 'alumni-card';
            
            // Add student class if current student
            if (alumni.isCurrentStudent) {
                card.classList.add('student');
            }

            // Get initials for avatar
            const initials = `${alumni.name.charAt(0)}${alumni.surname.charAt(0)}`.toUpperCase();
            
            // Determine gender class - this is now consistent
            let genderClass = 'other';
            if (alumni.gender === 'Male') genderClass = 'male';
            if (alumni.gender === 'Female') genderClass = 'female';

            // Create Instagram link HTML
            let instagramHTML = '';
            if (alumni.instagramId) {
                if (alumni.instagramValid) {
                    instagramHTML = `
                        <div class="instagram-container">
                            <a href="https://instagram.com/${alumni.instagramId}" target="_blank" class="instagram-link" title="View Instagram Profile">
                                <i class="fab fa-instagram"></i>
                                <span>@${alumni.instagramId}</span>
                            </a>
                        </div>
                    `;
                } else {
                    instagramHTML = `
                        <div class="instagram-container">
                            <span class="instagram-link disabled" title="Invalid Instagram ID">
                                <i class="fab fa-instagram"></i>
                                <span>Invalid ID</span>
                            </span>
                        </div>
                    `;
                }
            }

            card.innerHTML = `
                ${alumni.isCurrentStudent ? '<div class="student-badge">Student</div>' : ''}
                <div class="alumni-avatar ${genderClass}">${initials}</div>
                <h3 class="alumni-name">${alumni.name} ${alumni.surname}</h3>
                <p class="alumni-status">${alumni.isCurrentStudent ? 'Current Student' : 'Alumni'}</p>
                <p class="alumni-year">${alumni.passoutYear}</p>
                ${instagramHTML}
            `;

            return card;
        }

        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredAlumni.length / ITEMS_PER_PAGE);
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.innerHTML = '';
            pagination.style.display = 'flex';

            // Previous button
            const prevButton = document.createElement('button');
            prevButton.className = 'pagination-btn';
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderAlumniGrid();
                    renderPagination();
                }
            });
            pagination.appendChild(prevButton);

            // Page buttons
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    renderAlumniGrid();
                    renderPagination();
                });
                pagination.appendChild(pageButton);
            }

            // Next button
            const nextButton = document.createElement('button');
            nextButton.className = 'pagination-btn';
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderAlumniGrid();
                    renderPagination();
                }
            });
            pagination.appendChild(nextButton);
        }

        // Filter alumni based on search
        function filterAlumni() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                filteredAlumni = [...allAlumni];
            } else {
                filteredAlumni = allAlumni.filter(alumni => {
                    const fullName = `${alumni.name} ${alumni.surname}`.toLowerCase();
                    return fullName.includes(searchTerm);
                });
            }

            currentPage = 1;
            updateProfileCount();
            
            if (filteredAlumni.length === 0) {
                showNoData();
            } else {
                hideMessages();
                renderAlumniGrid();
                renderPagination();
            }
        }

        // Show error message
        function showError(message) {
            loadingEl.style.display = 'none';
            errorMessage.textContent = message;
            errorEl.style.display = 'block';
            profileCount.textContent = 'Error loading profiles';
        }

        // Show no data message
        function showNoData() {
            loadingEl.style.display = 'none';
            alumniGrid.style.display = 'none';
            pagination.style.display = 'none';
            noDataEl.style.display = 'block';
            profileCount.textContent = '0 Alumni Profiles';
        }

        // Hide all messages
        function hideMessages() {
            loadingEl.style.display = 'none';
            errorEl.style.display = 'none';
            noDataEl.style.display = 'none';
        }

        // Event listeners
        searchInput.addEventListener('input', filterAlumni);
        retryButton.addEventListener('click', initDirectory);

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initDirectory);
    </script>
</body>
</html>
